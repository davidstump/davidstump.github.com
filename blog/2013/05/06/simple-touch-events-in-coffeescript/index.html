
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Simple Touch Events in CoffeeScript - David Stump</title>
  <meta name="author" content="David Stump">

  
  <meta name="description" content="This article was originally published at Littlelines. I am an avid fan of simple, clean and elegant CoffeeScript (and thus JavaScript of course).
On &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://davidstump.github.com/blog/2013/05/06/simple-touch-events-in-coffeescript/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="David Stump" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=Raleway:100" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic|Istok+Web:400,400italic,700,700italic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37247497-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
  <div id="header-container">
    <div id="header">
      <div class="wrapper">
        <header role="banner"><hgroup>
  <h1>
    <a href="/">
      <img src="/images/avatar.jpg" alt="David Stump" id="avatar" />
      David Stump
    </a>
  </h1>
</hgroup>

</header>
        <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:davidstump.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="http://www.linkedin.com/in/davidstump/" target="_blank">Profile</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
      </div>
    </div>
  </div>
  <div id="body"   >
    <div id="main">
      <div id="content">
	<div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Simple Touch Events in CoffeeScript</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-06T00:01:00Z" pubdate data-updated="true">May 6<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><em>This article was originally published at <a href="http://littlelines.com/blog/2013/05/06/simple-touch-events-in-coffeescript/">Littlelines</a>.</em></p>

<p>I am an avid fan of simple, clean and elegant CoffeeScript (and thus JavaScript of course).
On top of your code being more approachable, I love the sense of accomplishment when
I find a clean way to solve a problem without immediately jumping to an external
library or plugin. Thus, when I was faced with the problem of handling touch
events on handheld and tablet devices for our new site, I started with a
blank page in my favorite editor.</p>

<p>Touch.coffee is a simple and straightforward CoffeeScript class written
with pure JavaScript that emits touch events to your application. The only
dependency this class utilizes is <a href="https://github.com/Wolfy87/EventEmitter">EventEmitter</a>
to aid in handling the event triggers. The full source for this class is available
for browsing on <a href="https://gist.github.com/davidstump/5499239">GitHub</a></p>

<p>To get our class started, we will setup a few variables that will help us along the way.</p>

<pre><code>@Touch=
  horizontalSensitivity: 22
  verticalSensitivity: 6
  touchDX: 0
  touchDY: 0
  touchStartX: 0
  touchStartY: 0
</code></pre>

<p>The sensitivity variables allow us to specify how long a touch event should last before
we go ahead and emit our event to the rest of the application. This helps us differentiate
between a swipe style gesture versus a simple tap. The next two variables will help us gauge the
distance travelled during our touch event. Finally, the last two will let us store the
starting point of our event.</p>

<pre><code>bind: (elements...) -&gt;
  for elem in elements
    elem.addEventListener "touchstart", (event) =&gt;
     @handleStart(event, elem)
    elem.addEventListener "touchmove", (event) =&gt;
     @handleMove(event, elem)
    elem.addEventListener "touchend", (event) =&gt;
     @handleEnd(event, elem)
</code></pre>

<p>First we want to add a bind method to our class to attach the appropriate touch events to
whichever DOM element (or elements) specified. This method handles one or more elements
and attaches the touchstart, touchmove and touchend events and delegates the appropriate
handler methods for each type.</p>

<pre><code>handleStart: (event, elem) -&gt;
  if event.touches.length is 1
    @touchDX = 0
    @touchDY = 0
    @touchStartX = event.touches[0].pageX
    @touchStartY = event.touches[0].pageY
</code></pre>

<p>Once we have the events attached to the correct elements, we need to tell our class how to
handle the various event types along the way. Here we store our initial values once the touch
event is initially registered.</p>

<pre><code>handleMove: (event, elem) -&gt;
  if event.touches.length &gt; 1
    @cancelTouch(elem)
    return false

  @touchDX = event.touches[0].pageX - @touchStartX
  @touchDY = event.touches[0].pageY - @touchStartY
</code></pre>

<p>Next we need a method fired during the portion of the touch event where our finger is moving
across the screen. During this event we want to detect if another touch event is registered
and reset our listeners to avoid complications. We also want to update our two variables
tasked with telling us the distance our touch event has travelled.</p>

<pre><code>handleEnd: (event,elem) -&gt;
  dx = Math.abs(@touchDX)
  dy = Math.abs(@touchDY)

  if (dx &gt; @horizontalSensitivity) and (dy &lt; (dx * 2 / 3))
    if @touchDX &gt; 0 then @emitSlideRight() else @emitSlideLeft()

  if (dy &gt; @verticalSensitivity) and (dx &lt; (dy * 2 / 3))
    if @touchDY &gt; 0 then @emitSlideDown() else @emitSlideUp()

  @cancelTouch(event, elem)
  false
</code></pre>

<p>Once a touchend event is triggered and the gesture is complete, we need to gather the total
distance travelled both horizontally and vertically. Once we have these values, we can use our
sensitivity variables to determine if the distance of the event is great enough to warrant emitting
to the rest of our application. We can also use the positive or negative value of
our difference/distance variable to indicate the specific direction of our event and emit the
correct notification.</p>

<pre><code>emitSlideLeft: -&gt; @emit 'swipe:left'
emitSlideRight: -&gt; @emit 'swipe:right'
emitSlideUp: -&gt; @emit 'swipe:up'
emitSlideDown: -&gt; @emit 'swipe:down'
</code></pre>

<p>Finally, once we have successfully registered a touch event and determined that it passes
our sensitivity threshold set initially, we need to emit the correct event to our application.
Using <a href="https://github.com/Wolfy87/EventEmitter">EventEmitter</a> we can easily send out the proper
event notification with very little code.</p>

<p>With our new touch class, we can now bind touch events to any elements in our application.</p>

<pre><code>Touch.bind document.getElementById('menu')
</code></pre>

<p>Once we have our bindings set, performing actions based our touch events is as easy as calling
a method when a touch event is detected.</p>

<pre><code>Touch.on 'swipe:left', =&gt; @toggleMenu()
</code></pre>

<p>While this class certainly doesn&#8217;t handle every possible interaction on a handheld or tablet
device, it does provide you with a great base for handling basic touch events throughout your
application with very little code. I welcome and look forward to any and all feedback, suggestions
and improvements and hope this little class proves helpful!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">David Stump</span></span>

      








  


<time datetime="2013-05-06T00:01:00Z" pubdate data-updated="true">May 6<span>th</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://davidstump.github.com/blog/2013/05/06/simple-touch-events-in-coffeescript/" data-via="davidstump" data-counturl="http://davidstump.github.com/blog/2013/05/06/simple-touch-events-in-coffeescript/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/02/10/use-git-to-manage-your-time/" title="Previous Post: Use Git To Manage Your Time">&laquo; Use Git To Manage Your Time</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/02/21/how-to-use-angular-and-keep-loving-rails/" title="Next Post: How To Use Angular and Keep Loving Rails">How To Use Angular and Keep Loving Rails &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/21/fun-with-variants-and-enums-in-rails-4-dot-1/">Fun with Variants and Enums in Rails 4.1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/21/how-to-use-angular-and-keep-loving-rails/">How To Use Angular and Keep Loving Rails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/06/simple-touch-events-in-coffeescript/">Simple Touch Events in CoffeeScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/10/use-git-to-manage-your-time/">Use Git To Manage Your Time</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/15/a-better-fullscreen-experience-in-sublime/">A Better Fullscreen Experience in Sublime</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/davidstump">@davidstump</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'davidstump',
            count: 6,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("davidstump", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/davidstump" class="twitter-follow-button" data-show-count="false">Follow @davidstump</a>
  
</section>





  
</aside>


      </div>
    </div>
    <footer role="contentinfo"><p>
  Copyright &copy; 2014 - David Stump -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>.</span>
</p>

</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'davidstump';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://davidstump.github.com/blog/2013/05/06/simple-touch-events-in-coffeescript/';
        var disqus_url = 'http://davidstump.github.com/blog/2013/05/06/simple-touch-events-in-coffeescript/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </div>
</body>
</html>
