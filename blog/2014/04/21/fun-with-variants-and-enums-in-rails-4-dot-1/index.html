
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Fun with Variants and Enums in Rails 4.1 - David Stump</title>
  <meta name="author" content="David Stump">

  
  <meta name="description" content="This article was originally published at Littlelines. The release of Rails 4.1 this past week included some cool new features two of which are the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://davidstump.github.com/blog/2014/04/21/fun-with-variants-and-enums-in-rails-4-dot-1/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="David Stump" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=Raleway:100" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic|Istok+Web:400,400italic,700,700italic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37247497-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
  <div id="header-container">
    <div id="header">
      <div class="wrapper">
        <header role="banner"><hgroup>
  <h1>
    <a href="/">
      <img src="/images/avatar.jpg" alt="David Stump" id="avatar" />
      David Stump
    </a>
  </h1>
</hgroup>

</header>
        <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:davidstump.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="http://www.linkedin.com/in/davidstump/" target="_blank">Profile</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
      </div>
    </div>
  </div>
  <div id="body"   >
    <div id="main">
      <div id="content">
	<div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Fun With Variants and Enums in Rails 4.1</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-21T09:51:00Z" pubdate data-updated="true">Apr 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><em>This article was originally published at <a href="http://littlelines.com/blog/2014/04/21/fun_with_variants_and_enums_in_rails_4_1/">Littlelines</a>.</em></p>

<p>The release of Rails 4.1 this past week included some <a href="http://weblog.rubyonrails.org/2014/4/8/Rails-4-1/">cool new features</a> two of which are the introduction of enums and variants. Enums give us some syntatic sugar for handling attributes like status, role, etc. Variants allow us to handle separate types of templates from within a respond_to block on a given action. I setup a <a href="https://github.com/davidstump/enums_and_variants">tiny Rails 4.1 application</a> to demonstrate one possible use for these two new features.</p>

<p><strong>Enum</strong></p>

<p>This application has a basic user model with a name string and an email string. The users controller contains basic index and show actions to show a list to users and their respective details. In the user model, I included an enum attribute <code>role</code> to handle differentiating between users of different types (student, admin or staff). The basic way of defining an enum attribute is as follows:</p>

<pre><code>enum role: [:student, :admin, :staff]
</code></pre>

<p>However, with enums used in this fashion, order must always be maintained or you risk recasting your users with a new role unintentionally. Suppose, months later, a new developer comes along and adjusts the code above like so:</p>

<pre><code>enum role: [:golfer, :student, :admin, :staff]
</code></pre>

<p>We have now, inadvertanly, cast every user previously assigned with the role <code>:student</code> to <code>:golfer</code>. Oops.</p>

<p>For this reason I would most likely use explicitly defined enums to avoid any potential future mishaps:</p>

<pre><code>enum role: {student: 0, admin: 1, staff: 2}
</code></pre>

<p>In this example, even if my new developer friend stumbles across this and updates it, they would have to explicitly overwrite the role associated with a given integer to cause any harm.</p>

<p>Once I have my enum defined, I now have access to all kinds of goodies to use throughout my application. I can now easily determine a given users role:</p>

<pre><code>user.role # =&gt; "student"
</code></pre>

<p>I can easily determine if a user is a member of a particular role:</p>

<pre><code>user.student? # =&gt; true
</code></pre>

<p>I can quickly assign/update a user&#8217;s role:</p>

<pre><code>user.staff! # =&gt; [sql] true
</code></pre>

<p>Or see all of the users scoped to a particular role:</p>

<pre><code>User.staff # =&gt; #&lt;ActiveRecord::Relation []&gt;
</code></pre>

<p><strong>Variants</strong></p>

<p>Variants can be used within a respond_to block to handle the same action in separate ways. Using the <code>User</code> model from above, we can render a show page unique for a particular user&#8217;s role.</p>

<pre><code>def show
  @user = User.find(params[:id])
  request.variant = @user.role.to_sym
  respond_to do |format|
    format.html do |html|
      html.student
      html.staff
      html.admin
    end
  end
end
</code></pre>

<p>In this example, the variants of the show action such as <code>html.student</code> will render a view template with the name matching: <code>show.html+student.haml</code> (or erb if you prefer). This allows us to use the same logic from our show action but render different content/layouts. This pattern could also be used to present different templates for mobile devices, webviews inside native mobile apps, etc.</p>

<p>With very little additional code, enums and variants allowed me to add a very basic role engine to my application and render content unique to a user&#8217;s role. These are just two of the fun new updates released in Rails 4.1. Check out the <a href="http://edgeguides.rubyonrails.org/4_1_release_notes.html">Release Notes</a> for some additional reading.</p>

<p>Cheers!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">David Stump</span></span>

      








  


<time datetime="2014-04-21T09:51:00Z" pubdate data-updated="true">Apr 21<span>st</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://davidstump.github.com/blog/2014/04/21/fun-with-variants-and-enums-in-rails-4-dot-1/" data-via="davidstump" data-counturl="http://davidstump.github.com/blog/2014/04/21/fun-with-variants-and-enums-in-rails-4-dot-1/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/02/21/how-to-use-angular-and-keep-loving-rails/" title="Previous Post: How To Use Angular and Keep Loving Rails">&laquo; How To Use Angular and Keep Loving Rails</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/21/fun-with-variants-and-enums-in-rails-4-dot-1/">Fun with Variants and Enums in Rails 4.1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/21/how-to-use-angular-and-keep-loving-rails/">How To Use Angular and Keep Loving Rails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/06/simple-touch-events-in-coffeescript/">Simple Touch Events in CoffeeScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/10/use-git-to-manage-your-time/">Use Git To Manage Your Time</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/15/a-better-fullscreen-experience-in-sublime/">A Better Fullscreen Experience in Sublime</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/davidstump">@davidstump</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'davidstump',
            count: 6,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("davidstump", 5, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/davidstump" class="twitter-follow-button" data-show-count="false">Follow @davidstump</a>
  
</section>





  
</aside>


      </div>
    </div>
    <footer role="contentinfo"><p>
  Copyright &copy; 2014 - David Stump -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>.</span>
</p>

</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'davidstump';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://davidstump.github.com/blog/2014/04/21/fun-with-variants-and-enums-in-rails-4-dot-1/';
        var disqus_url = 'http://davidstump.github.com/blog/2014/04/21/fun-with-variants-and-enums-in-rails-4-dot-1/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </div>
</body>
</html>
